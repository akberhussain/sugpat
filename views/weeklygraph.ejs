<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sugpat</title>

    <!-- Global stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
    <link href="assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
    <link href="assets/css/bootstrap.css" rel="stylesheet" type="text/css">
    <link href="assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="assets/css/colors.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/components/button.min.css">
    <link rel="stylesheet" href="/stylesheets/main.css">
    <!-- /global stylesheets -->

    <!-- Core JS files -->
    <script type="text/javascript" src="assets/js/plugins/loaders/pace.min.js"></script>
    <script type="text/javascript" src="assets/js/core/libraries/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/core/libraries/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/loaders/blockui.min.js"></script>
    <!-- /core JS files -->

    <!-- Theme JS files -->
    <script type="text/javascript" src="assets/js/plugins/visualization/d3/d3.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/visualization/d3/d3_tooltip.js"></script>
    <script type="text/javascript" src="assets/js/plugins/forms/styling/switchery.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/forms/styling/uniform.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/forms/selects/bootstrap_multiselect.js"></script>
    <script type="text/javascript" src="assets/js/plugins/ui/moment/moment.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/pickers/daterangepicker.js"></script>

    <script type="text/javascript" src="assets/js/core/app.js"></script>
    <script type="text/javascript" src="assets/js/pages/dashboard.js"></script>

    <script type="text/javascript" src="assets/js/pages/general_widgets_stats.js"></script>

    <script type="text/javascript" src="assets/js/plugins/ui/ripple.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    <!-- /theme JS files -->

<script language="JavaScript">

    var Request = new XMLHttpRequest();
    Request.open("Get","/get_chart_data");




    Request.onload = function(){
    

        // Request.responseText
        // for(i =0; i<(Request.responseText).length; i++){
        //     console.log(Request.responseText);
        // }
         // console.log(Request.responseText);
         var a = JSON.parse(Request.responseText);
            // console.log(a[0]);
            var SL = [];
            var dates= [];
            var DSL = [];
            var count = 0;         
            var average = 0;
            var anothercount = 0;    

         for(i=a[1].length-1; i>=0;i--){
            // a[1].length
            if(a[1][i].author1.id==a[0]){

                // DSL.push(a[1][i].date1.split('-'));
                // // console.log(a[1][i]);                
                // SL.push(a[1][i].sugarLevel);
                count++;
                anothercount++;
                average += a[1][i].sugarLevel;

                if(count%7==0){
                    average = average/7;
                    SL.push(average);
                    DSL.push(a[1][i].date1);
                    average = 0;
                    count = 0;
                    if(anothercount==112){
                        break;
                    }
                }

            }
         }
        console.log(SL);
        console.log(DSL);
        console.log(average);

         // console.log(DSL);
         // for(i = 0; i<DSL.length; i++){
         //    // 
         //    // dates.push(DSL[i][2]);

         // }

         // console.log(SL);
         // var arr = [Request.responseText];
         // console.log(arr);
         // console.log(typeof(arr));
         // displayLineChart() {
            // console.log(dates);
    var data = {
        // labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],
        labels: DSL,
        datasets: [
            {
                label: "Monthly Average",
                 borderColor: "#8e5ea2",
                // fillColor: "rgba(65, 89, 244, 0.8)",
                fillColor: "#3F51B5",
                strokeColor: "rgb(220,220,220)",
                pointColor: "rgba(229, 48, 48, 0.8)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                // data: [122, 133, 135, 107, 111, 139, 110, 119, 123, 100,100,120,130,90,110,122,100]
                data: SL
            }
        ]
    };
    var ctx = document.getElementById("lineChart").getContext("2d");
    var options = { };
    var lineChart = new Chart(ctx).Line(data, options);
  }

    // }
    Request.send();

  // function 
  // displayLineChart();
  --></script>

</head>

<body>

<div class="navbar navbar-inverse bg-indigo">
        <div class="navbar-header">
            <a class="navbar-brand"  href="#" style = "padding: 0px;"><img  src="assets/my_assets/logo.png" alt="" style = "width:60px; height: 50px;"></a>
            <a class="navbar-brand" href="#" style = "padding-left: 0px;">Sugpat</a>

            <ul class="nav navbar-nav visible-xs-block">
                <li><a data-toggle="collapse" data-target="#navbar-mobile"><i class="icon-tree5"></i></a></li>
                <li><a class="sidebar-mobile-main-toggle"><i class="icon-paragraph-justify3"></i></a></li>
            </ul>
        <% if(currentUser&&(currentUser.id== admin )){ %>
            <ul class="nav navbar-nav">
                <!-- <li><a href="/requests">Requests <span class = "icon-bell2"></span></a></li> -->




                <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Requests
                            <i class="icon-bell2"></i>
                        </a>

                        <div class="dropdown-menu dropdown-content">
                            <div class="dropdown-content-heading">
                                Requests
                                <!-- <ul class="icons-list">
                                    <li><a href="#"><i class="icon-menu7"></i></a></li>
                                </ul> -->
                            </div>

                            <ul class="media-list dropdown-content-body width-350">
                                <li class="media">
                                    <div class="media-left">
                                        <a href="/signuprequests" class="btn bg-success-400 btn-rounded btn-icon btn-xs"><i class="icon-mention"></i></a>
                                    </div>

                                    <div class="media-body">
                                        <a href="/signuprequests">Profile Requests</a>
                                        <div class="media-annotation"></div>
                                    </div>
                                </li>

                            
                                <li class="media">
                                    <div class="media-left">
                                        <a href="/requests" class="btn bg-blue btn-rounded btn-icon btn-xs"><i class="icon-plus3"></i></a>
                                    </div>
                                    
                                    <div class="media-body">
                                        <a href="/requests">Appointment Requests</a>
                                        <div class="media-annotation"></div>
                                    </div>
                                </li>

                            </ul>
                        </div>
                    </li>
            </ul>
         <% } %>
        </div>

        <div class="navbar-collapse collapse" id="navbar-mobile">
            <ul class="nav navbar-nav">
                <!-- <li><a href="#">Requests</a></li> -->
                <li><a class="sidebar-control sidebar-main-toggle hidden-xs"><i class="icon-paragraph-justify3"></i></a></li>
            </ul>

            <div class="nav navbar-nav navbar-right">
                <% if(currentUser){ %>
                    <li><a href="#">Signed in as <%= currentUser.name %></a></li>
            <% } %>
                
            </div>
        </div>
</div>
    <!-- /main navbar -->

<div class = "container">
      <% if (error && error.length > 0){ %>
        <div class = "alert alert-danger">
          <%= error %>
        </div>
      <% } %>
      <% if (success && success.length > 0){ %>      
        <div class = "alert alert-success">
          <%= success %>
        </div>
      <% } %>
    </div>

<!-- Page container -->
<div class="page-container">

        <!-- Page content -->
<div class="page-content">


<div class="sidebar sidebar-main sidebar-default">
                <div class="sidebar-content">

                    <!-- User menu -->
                    <div class="sidebar-user-material">
                        <div class="category-content">
                            <div class="sidebar-user-material-content">
                                <a href="#"><img src="assets/images/placeholder.jpg" class="img-circle img-responsive" alt=""></a>
                                <h6><%= currentUser.name %></h6>
                                <span class="text-size-small">Sindh, Pakistan</span>
                            </div>
                                                        
                            <div class="sidebar-user-material-menu">
                                <a href="#user-nav" data-toggle="collapse"><span>My account</span> <i class="caret"></i></a>
                            </div>
                        </div>
                        
                        <div class="navigation-wrapper collapse" id="user-nav">
                            <ul class="navigation">
                                <li><a href="/aboutme"><i class="icon-user-plus"></i> <span>My profile</span></a></li>        
                                <li class="divider"></li>
                                 <li><a href="/myaccount<%= currentUser._id %>"><i class="icon-user-plus"></i> <span>Account Settings</span></a></li> 
                                <li class="divider"></li>
                                <li><a href="/logout"><i class="icon-switch2"></i> <span>Logout</span></a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- /user menu -->


                    <!-- Main navigation -->
                    <div class="sidebar-category sidebar-category-visible">
                        <div class="category-content no-padding">
                            <ul class="navigation navigation-main navigation-accordion">


                                        

                                <!-- Main -->
                                <li class="navigation-header"><span>Main</span> <i class="icon-menu" title="Main pages"></i></li>

                                    <% if(currentUser&&(currentUser.id== admin )){ %>
            
                                        <li><a href="/profile"><i class="icon-list-unordered"></i><span>Home</span></a></li>
                                        <li><a href="/patients"><i class="icon-list-unordered"></i><span>Patient List</span></a></li>
                                        <li><a href="/doctors"><i class="icon-list-unordered"></i><span>Doctors List</span></a></li>
                                        <li><a href="/register"><i class="icon-list-unordered"></i><span>Add Doctor</span></a></li>
                                        <!-- <li><a href="/logout"><i class="icon-list-unordered"></i><span>Sign Out</span></a></li> -->
                                    <% } %>
                                    
                                 <% if(currentUser&&(currentUser.id != admin )){ %>

                                <li><a href="/profile"><i class="icon-home4"></i> <span>Basic Info</span></a></li>
                                <li>
                                    <a href="/sugarlevel"><i class="icon-copy"></i> <span>Dialbetes Levels</span></a>
                                </li>
                                <li>
                                    <a href="/sugarinfo"><i class="icon-droplet2"></i> <span>Diabetes Info</span></a>
                                </li>
                                <li>
                                    <a href="/sugarstatus<%= currentUser.id %>"><i class="icon-stack"></i> <span>Diabetes Status</span></a>
                                </li>   
                                <li>
                                    <a href="/appointments"><i class="icon-stack"></i> <span>See My Appointments</span></a>
                                </li>
                                <li>
                                    <a href="/selectdoctor"><i class="icon-stack2"></i> <span>Select Doctor</span></a>
                                </li>

                                   <% } %>

                                <li><a href="/logout"><i class="icon-list-unordered"></i> <span>Logout</span></a></li>
                          
                                <!-- /main -->

                            </ul>
                        </div>
                    </div>
                    <!-- /main navigation -->

                </div>
            </div>

                            <!-- Content area -->
            <div class = "content-wrapper">                
                <div class="content">
    <div class="row">
    	<div class="col-lg-12">

                            <!-- Traffic sources -->
                            <div class="panel panel-flat">
                                <div class="panel-heading">
                                    <h1 class="panel-title">Diabetes Status Weekly Graph</h1>
                                    <div class="heading-elements">
                                        <span><a class = "btn btn-primary" href = "/sugarstatus<%= currentUser.id %>">Generate Monthly Graph</a></span>
                                    </div>
                                </div>

                                <div class="container-fluid">
                                    <div class="row">
                                        

                                        <div class="col-lg-12">

										  <div class="box">
										    <canvas id="lineChart" height="300" width="500"></canvas>
										  </div>       

                                        </div>

                                    </div>
                                </div>

                                <div class="position-relative" id=""></div>
                            </div>
                            <!-- /traffic sources -->
                        </div>
    </div>	

<% include ./partials/footer %>
